USE ClothingStore
GO


-- TRANSACTION 2


-- dirty reads

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--- solution
--- SET TRANSACTION ISOLATION LEVEL READ COMMITTED

BEGIN TRAN
	SELECT *
	FROM Collection
	WHERE Did LIKE 'BB'
COMMIT TRAN

PRINT @@TRANCOUNT



-- non-repeatable reads

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--- solution
--- SET TRANSACTION ISOLATION LEVEL READ COMMITTED

BEGIN TRAN
	SELECT *
	FROM Collection
	WHERE Did LIKE 'BB'

	-- ...

	SELECT *
	FROM Collection
	WHERE Did LIKE 'BB'
COMMIT TRAN



-- phantom reads

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
--- solution
--- SET TRANSACTION ISOLATION LEVEL SERIALIZABLE

BEGIN TRAN
	SELECT *
	FROM Collection
	WHERE Did LIKE 'BB'

	-- ...

	SELECT *
	FROM Collection
	WHERE Did LIKE 'BB'
COMMIT TRAN



-- deadlocks

SET TRANSACTION ISOLATION LEVEL READ COMMITTED
--- solution
--- SET DEADLOCK_PRIORITY HIGH

BEGIN TRAN
	UPDATE Collection
	SET Year=2021
	WHERE Cid = 4

	SELECT *
	FROM Collection
	WHERE Cid = 1
ROLLBACK TRAN